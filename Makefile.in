CFLAGS = -Wall -g -O3
CC = gcc
LFLAGS = @LSOCKET@ @LNSL@

ifdef DEBUG_GCOV
CFLAGS += -fprofile-arcs -ftest-coverage -fbranch-probabilities
LFLAGS += -fprofile-arcs -ftest-coverage -fbranch-probabilities
endif

ifdef DEBUG_GDB
CFLAGS += -ggdb
LFLAGS += -ggdb
endif

ifdef DEBUG_GPROF
CFLAGS += -pg
LFLAGS += -pg
endif

objects = compat.o config.o dnsbl.o irc.o log.o main.o match.o misc.o \
    opercmd.o scan.o stats.o

checker_obj = bopchecker.o config.o match.o misc.o scan.o

all: bopm bopchecker
	rm -f *.da

compat.o:  setup.h compat.h
config.o:  setup.h config.h log.h match.h
dnsbl.o:   setup.h dnsbl.h extern.h irc.h log.h opercmd.h scan.h
irc.o:     setup.h config.h dnsbl.h extern.h irc.h log.h match.h opercmd.h options.h scan.h
log.o:     setup.h extern.h log.h
main.o:    setup.h extern.h irc.h log.h opercmd.h scan.h stats.h
match.o:   setup.h match.h
misc.o:    setup.h extern.h misc.h
opercmd.o: setup.h extern.h irc.h log.h misc.h opercmd.h scan.h
scan.o:    setup.h config.h dnsbl.h extern.h irc.h log.h opercmd.h scan.h stats.h
stats.o:   setup.h extern.h irc.c misc.h stats.h

bopchecker.o: bopchecker.h config.h irc.h options.h scan.h

bopm: $(objects)
	$(CC) $(LFLAGS) -o bopm $(objects)

bopchecker: $(checker_obj)
	$(CC) $(LFLAGS) -o bopchecker $(checker_obj)

.PHONY: clean
clean: 
	rm -f *.o *.da bopm bopchecker

.PHONY: distclean
distclean: clean
	rm -f config.cache config.log config.status setup.h Makefile

